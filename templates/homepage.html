{% extends "layout.html" %}

{% block title %}
Home
{% endblock %}

{% block main %}
<div class="p-10 flex flex-col w-full gap-10 text-slate-800">
    <div class="flex justify-around items-center">
        <div>
            <p class="underline text-xl">Cash Total</p>
            <p class="text-lg sm:text-xl font-bold text-right" id="displayCash"></p>
        </div>
        <div>
            <p class="underline text-xl">Stocks Total</p>
            <p class="text-lg sm:text-xl font-bold text-right" id="displayStocksTotal"></p>
        </div>
        <div>
            <p class="underline text-xl">Portfolio Total</p>
            <p class="text-lg sm:text-xl font-bold text-right" id="displayPortfolioTotal"></p>
        </div>
    </div>
    <div class="w-full flex justify-center items-center">
        <table class="w-5/6">
            <thead class="border-b border-b-slate-600">
                <tr>
                    <th class="text-start">Company</th>
                    <th class="text-start">Ticker Symbol</th>
                    <th class="text-end">Share Price</th>
                    <th class="text-end">No. of shares</th>
                    <th class="text-end">Total</th>
                </tr>
            </thead>
            <tbody id="displayState">
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4" class="text-end font-bold">Shares Total</td>
                    <td class="text-end font-bold" id="displaySharesTotal"></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <div id="loading" class="flex items-center justify-center">
        <span class="loading loading-ring loading-lg"></span>
    </div>
    <script>
        let displayCash = document.querySelector("#displayCash");
        let displayStocksTotal = document.querySelector("#displayStocksTotal");
        let displayPortfolioTotal = document.querySelector("#displayPortfolioTotal");
        let displayState = document.querySelector("#displayState");
        let displaySharesTotal = document.querySelector("#displaySharesTotal");
        let loading = document.querySelector("#loading");
        let createElement = (element) => document.createElement(element);

        async function getSummary () {
            let url = `/api/user/summary`;
            let response = await fetch(url);
            let summary = await response.json();
            loading.classList.add("hidden");
            displaySummary(summary);
        }
        getSummary();

        function displaySummary (summary) {
            displayCash.textContent = `$${summary.cash.toFixed(2)}`;
            displayStocksTotal.textContent = `$${summary.stocks_total.toFixed(2)}`;
            displayPortfolioTotal.textContent = `$${summary.portfolio_total.toFixed(2)}`;
            displaySharesTotal.textContent = `$${summary.stocks_total.toFixed(2)}`;
            for (let i = 0; i < summary.state.length; i++) {
                let row = createElement("tr");
                let name = createElement("td");
                let ticker = createElement("td");
                let price = createElement("td");
                let shares = createElement("td");
                let total = createElement("td");

                price.classList.add("text-end");
                shares.classList.add("text-end");
                total.classList.add("text-end");
                i % 2 ? row.classList.add('bg-gray-300') : row.classList.add('bg-none');

                name.textContent = summary.state[i].name;
                ticker.textContent = summary.state[i].ticker;
                price.textContent = `$${summary.state[i].price.toFixed(2)}`;
                shares.textContent = summary.state[i].shares;
                total.textContent = `$${summary.state[i].total.toFixed(2)}`;
                row.appendChild(name);
                row.appendChild(ticker);
                row.appendChild(price);
                row.appendChild(shares);
                row.appendChild(total);
                displayState.appendChild(row);
            }
        }
    </script>
</div>
{% endblock %}